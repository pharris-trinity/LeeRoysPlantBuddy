<!-- views/checkout.ejs -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/styles/styles.css">
		<link rel="icon" type="image/x-icon" href="/images/leeroyhead.png">
		<title>Checkout</title>
        <style>
			table, td {
				border: none;
				border-spacing: 7px;
				display: inline;
				padding: 10px;
				text-align: center;
			}
        </style>
		<script>
            function removeFromCart(id, name, price) {
                fetch('/removeFromCart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id, name, price }),
                })
                .then(response => {
                    if(!response.ok) {
                        throw new Error(`HTTP Error! Status: ${response.status}`)
                    }
                })
            }
            // function addToCart(id, name, price) {
            //     fetch('/addToCart', {
            //         method: 'POST',
            //         headers: {
            //             'Content-Type': 'application/json',
            //         },
            //         body: JSON.stringify({ 
			// 			id, 
			// 			name, 
			// 			price 
			// 		}),
            //     })
            //     .then(response => {
            //         if(!response.ok) {
            //             throw new Error(`HTTP Error! Status: ${response.status}`)
            //         }
            //     })
            // }
            function emptyCart() {
                fetch('/emptyCart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ cart }),
                })
                .then(response => {
                    if(!response.ok) {
                        throw new Error(`HTTP Error! Status: ${response.status}`)
                    }
                })
			}

			// function subtotal() {
			// 	let subprice = 0
			// 	cart.forEach(product => {
			// 		product.price += subprice
			// 	})
			// 	return subprice
			// 	}


			// function taxCalc(subprice) {
			// 	return subprice * 0.625
			// }

			// const tax = 5.99 * 0.625
			// document.getElementById("salestax").innerHTML = tax

			// function totalCalc(subtotal, tax, shipping) {
			// 	return subtotal + taxCalc(subtotal) + shipping
			// }
		</script>
    </head>
    <body>
		<div class="header">
		    <button class="button" style="display: block;"><a href="/login" style="color: #fafafa;">Login</a> </button>
		</div>	
		<div class="header-text">
			<h3 style="text-align: center;">San Antonio's best for pets and pet needs!</h3>
		</div>
		<div class="navbar">
			<span><a href="/">Home</a></span>
			<span><a href="/product">Products</a></span>
			<span><a href="/checkout">Checkout</a></span>
			<span><a href="/login">Login</a></span>
		</div>
		<div class="row">
			<div class="column left" style="height: 350px; width: 25%;">
				<h2>Shopping Cart</h2>
				<div class="container">
					<table>
						<% cart.forEach(product => { %>
						<tr>
							<td><span><button class="add-quantity"></button> </span></td>
							<td><span><%= product.name %></span></td>
							<td><span>$<%= product.price %></span></td>
							<td><span><button class="remove-from-cart" onclick="removeFromCart('<%=product.id%>', '<%=product.name%>', '<%=product.price%>')"></button></span></td>
						</tr>
						<% }); %>
					</table>
				</div>
			</div>
			<div class="column right" style="height: 350px; width: 25%;">
				<h2>Order Summary</h2>
					<div class="container">
						<div class="row">
							<div class="column left" style="height: 75px; width: 50px; margin-top: 0; text-align: left;">
								Subtotal:
								<p> Tax:</p>
								<p> Shipping:</p>
							</div>
							<div class="column right" style="height: 75px; width: 50px; margin-top: 0; text-align: left;">
								$<span><%  %></span>
								<p>$<span><%= +(Math.round((5.99 * 0.625) + "e+2") + "e-2")%></span></p>
								<p>$<span><%= +(Math.round((5.99 * 0.425) + "e+2") + "e-2")%></span></p>
							</div>
						</div>
					</div>
				<br> <br>
				<h4 > Total:  $13.93</h4> <!-- add altogether-->
				<br>
				<button class="button" onclick="cart.emptyCart()" style="display: inline-block;">Buy Now</button>
			</div>
		</div>
    </body>
</html>