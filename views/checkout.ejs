<!-- views/checkout.ejs -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/styles/styles.css">
		<link rel="icon" type="image/x-icon" href="/images/leeroyhead.png">
		<title>Checkout</title>
        <style>
			table, td {
				border: none;
				border-spacing: 7px;
				display: inline;
				padding: 10px;
				text-align: center;
			}
        </style>
		<script>
			function removeFromCart(id) {
                fetch('/removeFromCart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id }),
                })
                .then(response => {
                    if(!response.ok) {
                        throw new Error(`HTTP Error! Status: ${response.status}`)
                    }
                })
            }
            function addQuantity(id) {
                fetch('/addtoCart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id }),
                })
                .then(response => {
                    if(!response.ok) {
                        throw new Error(`HTTP Error! Status: ${response.status}`)
                    }
                })
            }
            function emptyCart(cart) {
                fetch('/emptyCart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ cart }),
                })
                .then(response => {
                    console.log(response);
                    if(!response.ok) {
                        throw new Error(`HTTP Error! Status: ${response.status}`)
                    }
                })
            }

			window.onload = function() {
				var cookieValue = document.cookie;

				console.log(cookieValue);
			}
		</script>
    </head>
    <body>
		<!-- <center><div class="header" align: center></div></center> -->
		<div class="header">
		    <button class="button" style="display: block;"><a href="/login" style="color: #fafafa;">Login</a> </button>
		</div>	
		<div class="header-text">
			<h3 style="text-align: center;">San Antonio's best for pets and pet needs!</h3>
		</div>
			
		
      <div class="navbar">
        <span><a href="/">Home</a></span>
        <span><a href="/product">Products</a></span>
        <span><a href="/checkout">Checkout</a></span>
		<span><a href="/login">Login</a></span>
      </div>
      <div class="row">
			<div class="column left" style="height: 350px; width: 25%;">
				<h2>Shopping Cart</h2>
					<div class="container">
						<table class="Cart">
							<% cart.forEach((product, productindx) => { %>
                            <tr>
                                <td><span><button class="add-quantity" onclick="addQuantity('<%=productindx%>'); window.location.reload();"></button> <%=product.quantity%></span></td>                                
                                <td><span><%=product.description%></span></td>
                                <td><span>$ <%=+(Math.round((product.price * product.quantity) + "e+2") + "e-2")%></span></td>
                                <td><span><button class="remove-from-cart" onclick="removeFromCart('<%=productindx%>');window.location.reload();"></button></span></td>
                            </tr>
                            <% }); %>
						</table>
					</div>
			</div>
				
     		<div class="column right" style="height: 350px; width: 25%;">
			
      		<h2>Order Summary</h2>
					<div class="container">
						<div class="row">
							<div class="column left" style="height: 75px; width: 50px; background-color: transparent; margin-top: 0; text-align: left;">
								<p> Subtotal:</p>
								<p> Tax:</p>
								<p> Shipping:</p>

							</div>
							<div class="column right" style="height: 75px; width: 50px; background-color: transparent;margin-top: 0;text-align: left;">
								<%let subtotal = 0%>
                                <%console.log(cart)%>
                                <%cart.forEach((id) => {subtotal += (id.price * id.quantity); });%>
                                <p><span> $<%=+(Math.round(subtotal + "e+2") + "e-2")%> </span></p>
                                <%let tax = +(Math.round((subtotal * 0.0625) + "e+2") + "e-2")%>
                                <p><span>$<%=tax%></span></p>
                                <%let shipping = +(Math.round((subtotal * 0.15) + "e+2") + "e-2")%>
                                <p><span>$<%=shipping%></span></p>

							</div>
						</div>
					</div>
					<br> <br>
                    <%let total = subtotal + tax + shipping%>
                <h4 > Total: <span>$<%=+(Math.round((total) + "e+2") + "e-2")%></span></h4> 
                <br>
                <button class="button" style="display: inline-block" onclick="emptyCart('<%=cart%>'); window.location.reload();" >Buy Now</button>
     		</div>
	  </div>
	
    </body>
</html>